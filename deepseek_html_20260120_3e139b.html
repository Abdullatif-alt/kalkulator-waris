<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a5e3e">
    <meta name="description" content="Kalkulator Warisan Islam - Hitung pembagian warisan sesuai hukum Islam">
    
    <!-- Ikon Base64 Terembed -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%231a5e3e'/><path d='M65,50 Q70,35 55,35 Q40,35 45,50 Q40,65 55,65 Q70,65 65,50' fill='%23ffffff'/><polygon points='50,40 55,50 65,50 57,57 60,67 50,60 40,67 43,57 35,50 45,50' fill='%23ffffff'/></svg>">
    
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQWSURBVHgB7d1NbhNBFMZxNzjZQOSOWVHAhiuwRA6IIs6BOISRuCBbDpAtOy7Amsu4F7AUaUrk8bzM89/vW4RNK5N/NZ0aV62xWJZlmc7CuaSfjL2Qn+bZWMq2nEv6RdgLeSlfzFepT5l4AelM7YW8M29lMqlhWcC6zF7IW9mZqbQp+VhAJy/krXmQ+qSKZQHrMl/IP9KQ1NlZOAvnwsIj1b+Qf6RBqeOaA9aFT+XL4PzE+ANu1t+Zp3Iu9bEmgHWZvZC35l5a4NoEWuf5uTwz99Iol/8CaA54Ia/ND2mUy3oB1sJrCf8V8CgNc7kA1jJfyV3U5V/6BeCF/CHvZajL/WYegPdm78dwFfUDaO2Hr0Y8gM5Z/gH/UQ/Q2bP8Z/EA3qN+AQM8yw9iAbxn+QHHBO8D8P8lH/I+AP/f8k5cH4D7NDbI/QHwwA65jvou0IV/Bnz1LgAP7JADr3sBeGCHHHl9AHhgh9x51QPgAzt0wOtaAB7YoQte1gV4D+zQjU/9ADjLjy6pB4CHdcic1/kCvJBP5k5qRze/8AWsc3wz36Q+Le6A8AK8kL80T9KB1n4Q+gG8B3Y53/VCL2Cd4538JqdSnxZ3QXgXQHtglxy5/vMCeI/+hLgHwNf7lF6C8AK8kE/SIfc/7gPwff4zqX8XhK//qT0G4QU4IZ+kc+4A7j/cPxDeBeDoT6/8g/tXjv6M1P64/6X8lo6x/8P9D7Inw6J/gDvAPc/w0D9w78OCH7VbH+i1f/AJcM4zPPQP3Puw4Ef9JACe4aF/8IVlwR+g3P9w74OCvzL3fgHt/Z7ZP3DvQ4MftXv/APc/8PDX4N4HZ/sG3vsnuP9h0Y8avX+Df3Hj/sN9Bgf/qpR/jOse4N4HB/+qlHcBeA98lANVxL2HC39kSd8I4p4D6xvwIY8a3Pu4+6+i5L+I4P7j7r+K0v9FDPc+5v6rqOJfRHHvc+6/iup+Fwz3Pub+q6j2d4Jx7+Pu4IuGvibOvY+5g1aaeicg9z7mDrZp7q2g3PuYO3im2U8E4N7H3MEuzb8UjHsfcwfbNP9W8C486/e3p2n+00G8B66T7Gn+E0L5HrgU0PyHROlfyEc5UAfY2fwnhPJeAD/Lj6zJD4jxXgD/Q6JzXgC+3if2oZb4Z5hvzFfzIH1J54tQ/B1A6zxfzXvpSzoWwJ9Bvhw/ynCufQWsJX5p7uVZhpP2Amgt8ZW5k2eRzrV2AfyZ45N5J/1J2wJ4If+ZJzLUaV8Av0W6NZ/kQYZz7Qvg9xzvzE3qU/IFeL/GvzFfzIP0q/QC+GF9Y+6kT2UugP3d/9rcm3vpW5kL4P3y9cE8mEdpX7kL4Gf5N+Ze+lX+AvgL0n0pWAB/kHNh7qRP5S+AH9aXMpSoBfCZ/IM5SB/KXwC/y78w99KfGAgP8I05SF/KXwC/fd2Yg/Sl/AXw3+62MQfpS/kL4Ht2v3EepD/lL4DP8m/MQfpT/gL4O/cr81X6U/4C+KG9MnfSnygIfwP7ZO6kT1EQ7oB350M6XwDjwvgD4Ov9nfQnCsIL4Hv5N9KnMAj/BPLj/TDpFwP7//f/BfAm/b58a25XAAAAAElFTkSuQmCC">
    
    <title>Kalkulator Warisan Islam</title>
    <style>
        /* Reset dan Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        /* Container Utama */
        .app-container {
            max-width: 100%;
            min-height: 100vh;
            background: #f8f9fa;
            position: relative;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a5e3e 0%, #2e8b57 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(26, 94, 62, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: "‚ò™Ô∏è";
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 30px;
            opacity: 0.3;
        }

        .header::after {
            content: "üìñ";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 30px;
            opacity: 0.3;
        }

        .app-title {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .app-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        /* Konten Utama */
        .main-content {
            padding: 20px;
            padding-bottom: 80px; /* Untuk navigasi bawah */
        }

        /* Kartu Input */
        .input-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #e8f5e9;
        }

        .section-title {
            color: #1a5e3e;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e8f5e9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: "";
            width: 6px;
            height: 20px;
            background: #1a5e3e;
            border-radius: 3px;
        }

        /* Input Group */
        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        .currency-input {
            position: relative;
        }

        .currency-input input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 500;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .currency-input input:focus {
            border-color: #1a5e3e;
            background: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 94, 62, 0.1);
        }

        .currency-input::before {
            content: "Rp";
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #1a5e3e;
            font-weight: bold;
            font-size: 18px;
            z-index: 1;
        }

        /* Toggle Group */
        .toggle-group {
            display: flex;
            background: #edf7ed;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .toggle-btn {
            flex: 1;
            padding: 14px;
            text-align: center;
            border-radius: 8px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 0.95rem;
        }

        .toggle-btn.active {
            background: white;
            color: #1a5e3e;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }

        /* Heir Item */
        .heir-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e8f5e9;
            position: relative;
        }

        .heir-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .heir-number {
            background: #1a5e3e;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .remove-heir {
            background: #ff4757;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .remove-heir:active {
            transform: scale(0.9);
        }

        .heir-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            background: white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231a5e3e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
        }

        .counter-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .counter-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 2px solid #1a5e3e;
            background: white;
            color: #1a5e3e;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .counter-btn:active {
            background: #1a5e3e;
            color: white;
        }

        .counter-display {
            flex: 1;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #2c3e50;
            font-weight: 500;
        }

        .checkbox-label input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: #1a5e3e;
        }

        /* Button Styles */
        .action-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a5e3e 0%, #2e8b57 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(26, 94, 62, 0.4);
        }

        .btn-primary:active {
            transform: translateY(2px);
            box-shadow: 0 4px 12px rgba(26, 94, 62, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #1a5e3e;
            border: 2px solid #1a5e3e;
        }

        .btn-secondary:active {
            background: #f8f9fa;
        }

        /* Hasil Perhitungan */
        .result-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #e8f5e9;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .result-title {
            color: #1a5e3e;
            font-size: 1.4rem;
            margin-bottom: 10px;
        }

        .total-estate {
            font-size: 0.9rem;
            color: #666;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #1a5e3e;
        }

        .heir-info {
            flex: 1;
        }

        .heir-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .heir-details {
            font-size: 0.85rem;
            color: #666;
        }

        .heir-amount {
            font-weight: bold;
            color: #1a5e3e;
            font-size: 1.1rem;
            text-align: right;
        }

        .amount-rupiah {
            font-size: 0.9rem;
            color: #666;
            margin-top: 3px;
        }

        .result-total {
            background: linear-gradient(135deg, #1a5e3e 0%, #2e8b57 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-top: 25px;
            text-align: center;
        }

        .total-label {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .total-amount {
            font-size: 1.8rem;
            font-weight: bold;
        }

        /* Navigation Bottom */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            color: #666;
            text-decoration: none;
            font-size: 0.8rem;
            flex: 1;
            transition: all 0.3s;
            border: none;
            background: none;
        }

        .nav-item.active {
            color: #1a5e3e;
            position: relative;
        }

        .nav-item.active::after {
            content: "";
            position: absolute;
            bottom: -12px;
            width: 6px;
            height: 6px;
            background: #1a5e3e;
            border-radius: 50%;
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }

        /* Responsive Design */
        @media (max-width: 360px) {
            .main-content {
                padding: 15px;
                padding-bottom: 70px;
            }
            
            .input-card, .result-card {
                padding: 20px;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 94, 62, 0.95);
            color: white;
            padding: 14px 24px;
            border-radius: 12px;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 90%;
            text-align: center;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1 class="app-title">Kalkulator Warisan Islam</h1>
            <p class="app-subtitle">Hitung pembagian warisan sesuai hukum Islam</p>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Input Section -->
            <div id="inputSection">
                <div class="input-card">
                    <h2 class="section-title">üí∞ Nilai Harta Warisan</h2>
                    
                    <div class="input-group">
                        <label class="input-label">Total Nilai Harta Warisan</label>
                        <div class="currency-input">
                            <input type="number" id="totalEstate" placeholder="0" min="0" inputmode="decimal">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Status Hutang Pewaris</label>
                        <div class="toggle-group">
                            <button class="toggle-btn active" onclick="toggleDebt('no')">Tidak Ada Hutang</button>
                            <button class="toggle-btn" onclick="toggleDebt('yes')">Ada Hutang</button>
                        </div>
                    </div>

                    <div id="debtSection" style="display: none;">
                        <div class="input-group">
                            <label class="input-label">Total Hutang Pewaris</label>
                            <div class="currency-input">
                                <input type="number" id="debtAmount" placeholder="0" min="0" inputmode="decimal">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-card">
                    <h2 class="section-title">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Tambah Ahli Waris</h2>
                    <div id="heirsContainer"></div>
                    
                    <button class="action-btn btn-secondary" onclick="addHeir()">
                        <span style="font-size: 24px;">+</span> Tambah Ahli Waris
                    </button>
                </div>

                <div class="input-card">
                    <h2 class="section-title">üìä Hitung Pembagian</h2>
                    <button class="action-btn btn-primary" onclick="calculateInheritance()">
                        <span>üßÆ</span> Hitung Pembagian Warisan
                    </button>
                    <button class="action-btn btn-secondary" onclick="resetCalculator()" style="margin-top: 15px;">
                        <span>üîÑ</span> Reset Semua
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="result-card">
                <div class="result-header">
                    <h2 class="result-title">Hasil Pembagian Warisan</h2>
                    <p class="total-estate" id="netEstateDisplay">Nilai bersih warisan: Rp 0</p>
                </div>
                
                <div id="resultsContainer"></div>
                
                <div class="result-total">
                    <div class="total-label">Total yang dibagikan:</div>
                    <div class="total-amount" id="totalDistributed">Rp 0</div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="showSection('input')">
                <span class="nav-icon">üßÆ</span>
                <span>Kalkulator</span>
            </button>
            <button class="nav-item" onclick="showSection('results')">
                <span class="nav-icon">üìä</span>
                <span>Hasil</span>
            </button>
            <button class="nav-item" onclick="showRules()">
                <span class="nav-icon">üìñ</span>
                <span>Aturan</span>
            </button>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // Data aplikasi
        let heirs = [];
        let nextHeirId = 1;
        
        // Daftar ahli waris
        const heirTypes = [
            { value: 'suami', label: 'Suami', icon: 'üë®', share: null },
            { value: 'istri', label: 'Istri/Istri-istri', icon: 'üë©', share: null },
            { value: 'anak_laki', label: 'Anak Laki-laki', icon: 'üë¶', share: null },
            { value: 'anak_perempuan', label: 'Anak Perempuan', icon: 'üëß', share: null },
            { value: 'ayah', label: 'Ayah', icon: 'üë¥', share: null },
            { value: 'ibu', label: 'Ibu', icon: 'üëµ', share: null },
            { value: 'kakek', label: 'Kakek (Dari Ayah)', icon: 'üë¥', share: null },
            { value: 'nenek', label: 'Nenek (Dari Ibu)', icon: 'üëµ', share: null },
            { value: 'saudara_laki', label: 'Saudara Laki-laki Kandung', icon: 'üë®‚Äçü¶∞', share: null },
            { value: 'saudara_perempuan', label: 'Saudara Perempuan Kandung', icon: 'üë©‚Äçü¶∞', share: null }
        ];

        // Format angka ke Rupiah
        function formatRupiah(angka) {
            if (!angka) return 'Rp 0';
            
            const number = parseFloat(angka);
            if (isNaN(number)) return 'Rp 0';
            
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(number);
        }

        // Format angka tanpa Rp
        function formatNumber(angka) {
            if (!angka) return '0';
            
            const number = parseFloat(angka);
            if (isNaN(number)) return '0';
            
            return new Intl.NumberFormat('id-ID').format(number);
        }

        // Inisialisasi aplikasi
        document.addEventListener('DOMContentLoaded', function() {
            // Tambah ahli waris pertama
            addHeir();
            
            // Format input nilai
            document.getElementById('totalEstate').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
            
            document.getElementById('debtAmount').addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
            
            // Load data dari localStorage jika ada
            loadFromLocalStorage();
        });

        // Toggle hutang
        function toggleDebt(option) {
            const buttons = document.querySelectorAll('.toggle-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const debtSection = document.getElementById('debtSection');
            debtSection.style.display = option === 'yes' ? 'block' : 'none';
        }

        // Tambah ahli waris
        function addHeir() {
            const heir = {
                id: nextHeirId++,
                type: 'anak_laki',
                count: 1,
                isAlive: true
            };
            heirs.push(heir);
            renderHeirs();
            saveToLocalStorage();
        }

        // Hapus ahli waris
        function removeHeir(id) {
            if (heirs.length <= 1) {
                showToast('Minimal harus ada 1 ahli waris');
                return;
            }
            
            heirs = heirs.filter(heir => heir.id !== id);
            renderHeirs();
            saveToLocalStorage();
            showToast('Ahli waris dihapus');
        }

        // Update ahli waris
        function updateHeir(id, property, value) {
            const heir = heirs.find(h => h.id === id);
            if (heir) {
                if (property === 'count') {
                    heir[property] = Math.max(1, parseInt(value) || 1);
                } else if (property === 'isAlive') {
                    heir[property] = Boolean(value);
                } else {
                    heir[property] = value;
                }
            }
            saveToLocalStorage();
        }

        // Render daftar ahli waris
        function renderHeirs() {
            const container = document.getElementById('heirsContainer');
            container.innerHTML = '';
            
            heirs.forEach((heir, index) => {
                const heirType = heirTypes.find(t => t.value === heir.type);
                
                const card = document.createElement('div');
                card.className = 'heir-card';
                card.innerHTML = `
                    <div class="heir-header">
                        <div class="heir-number">${index + 1}</div>
                        ${heirs.length > 1 ? `
                            <button class="remove-heir" onclick="removeHeir(${heir.id})">√ó</button>
                        ` : ''}
                    </div>
                    
                    <select class="heir-select" onchange="updateHeir(${heir.id}, 'type', this.value)">
                        ${heirTypes.map(type => `
                            <option value="${type.value}" ${heir.type === type.value ? 'selected' : ''}>
                                ${type.icon} ${type.label}
                            </option>
                        `).join('')}
                    </select>
                    
                    <div class="counter-group">
                        <button class="counter-btn" onclick="updateHeir(${heir.id}, 'count', ${heir.count - 1})" 
                                ${heir.count <= 1 ? 'disabled' : ''}>-</button>
                        <div class="counter-display">${heir.count} Orang</div>
                        <button class="counter-btn" onclick="updateHeir(${heir.id}, 'count', ${heir.count + 1})">+</button>
                    </div>
                    
                    <label class="checkbox-label">
                        <input type="checkbox" ${heir.isAlive ? 'checked' : ''} 
                               onchange="updateHeir(${heir.id}, 'isAlive', this.checked)">
                        Masih hidup saat pewaris meninggal
                    </label>
                `;
                container.appendChild(card);
            });
        }

        // Hitung pembagian warisan
        function calculateInheritance() {
            const totalEstate = parseFloat(document.getElementById('totalEstate').value) || 0;
            const hasDebt = document.querySelector('.toggle-btn:nth-child(2)').classList.contains('active');
            const debtAmount = parseFloat(document.getElementById('debtAmount').value) || 0;
            
            // Validasi input
            if (totalEstate <= 0) {
                showToast('Masukkan nilai harta warisan');
                document.getElementById('totalEstate').focus();
                return;
            }
            
            if (hasDebt && debtAmount > totalEstate) {
                showToast('Hutang tidak boleh melebihi nilai warisan');
                document.getElementById('debtAmount').focus();
                return;
            }
            
            // Hitung nilai bersih
            const netEstate = hasDebt ? Math.max(0, totalEstate - debtAmount) : totalEstate;
            
            // Hitung pembagian
            const results = calculateShares(netEstate);
            
            // Tampilkan hasil
            displayResults(results, netEstate);
            
            // Tampilkan section hasil
            showSection('results');
            
            // Simpan ke history
            saveToHistory(totalEstate, netEstate, results);
            
            showToast('Perhitungan selesai!');
        }

        // Algoritma perhitungan warisan Islam
        function calculateShares(netEstate) {
            const results = [];
            let totalShares = 0;
            
            // Group ahli waris berdasarkan jenis
            const heirGroups = {};
            heirs.forEach(heir => {
                if (!heir.isAlive) return;
                
                if (!heirGroups[heir.type]) {
                    heirGroups[heir.type] = [];
                }
                heirGroups[heir.type].push(heir);
            });
            
            // Hitung bagian masing-masing
            heirs.forEach(heir => {
                if (!heir.isAlive) return;
                
                const heirType = heirTypes.find(t => t.value === heir.type);
                let share = 0;
                let shareText = '';
                
                switch(heir.type) {
                    case 'suami':
                        const hasChildren = heirs.some(h => 
                            (h.type === 'anak_laki' || h.type === 'anak_perempuan') && h.isAlive);
                        share = hasChildren ? 1/4 : 1/2;
                        shareText = hasChildren ? '¬º (ada anak)' : '¬Ω (tidak ada anak)';
                        break;
                        
                    case 'istri':
                        const hasChildrenWife = heirs.some(h => 
                            (h.type === 'anak_laki' || h.type === 'anak_perempuan') && h.isAlive);
                        share = hasChildrenWife ? 1/8 : 1/4;
                        shareText = hasChildrenWife ? '‚Öõ (ada anak)' : '¬º (tidak ada anak)';
                        break;
                        
                    case 'anak_laki':
                        const daughters = heirs.filter(h => 
                            h.type === 'anak_perempuan' && h.isAlive);
                        const sons = heirs.filter(h => 
                            h.type === 'anak_laki' && h.isAlive);
                        
                        if (daughters.length === 0) {
                            // Hanya anak laki
                            share = 1;
                            shareText = 'Sisa (ashabah)';
                        } else {
                            // Ada anak perempuan
                            share = 2; // Laki-laki dapat 2x perempuan
                            shareText = '2:1 (ashabah)';
                        }
                        break;
                        
                    case 'anak_perempuan':
                        const totalDaughters = heirs.filter(h => 
                            h.type === 'anak_perempuan' && h.isAlive).length;
                        const totalSons = heirs.filter(h => 
                            h.type === 'anak_laki' && h.isAlive).length;
                        
                        if (totalSons === 0) {
                            // Hanya anak perempuan
                            if (totalDaughters === 1) {
                                share = 1/2;
                                shareText = '¬Ω (sendirian)';
                            } else {
                                share = 2/3;
                                shareText = '‚Öî (bersama-sama)';
                            }
                        } else {
                            // Ada anak laki-laki
                            share = 1; // Perempuan dapat ¬Ω dari laki
                            shareText = '2:1 (ashabah)';
                        }
                        break;
                        
                    case 'ayah':
                        const hasChildrenFather = heirs.some(h => 
                            (h.type === 'anak_laki' || h.type === 'anak_perempuan') && h.isAlive);
                        share = hasChildrenFather ? 1/6 : 1/3;
                        shareText = hasChildrenFather ? '‚Öô (ada anak)' : '‚Öì (tidak ada anak)';
                        break;
                        
                    case 'ibu':
                        const hasChildrenMother = heirs.some(h => 
                            (h.type === 'anak_laki' || h.type === 'anak_perempuan') && h.isAlive);
                        const hasSiblings = heirs.some(h => 
                            (h.type === 'saudara_laki' || h.type === 'saudara_perempuan') && h.isAlive);
                        
                        if (!hasChildrenMother && !hasSiblings) {
                            share = 1/3;
                            shareText = '‚Öì (tidak ada anak/saudara)';
                        } else {
                            share = 1/6;
                            shareText = '‚Öô (ada anak/saudara)';
                        }
                        break;
                        
                    default:
                        share = 1/6;
                        shareText = '‚Öô (default)';
                }
                
                // Hitung total bagian untuk kelompok ini
                const groupCount = heirGroups[heir.type].length;
                let groupShare = share;
                
                // Adjust untuk multiple heirs
                if (heir.type === 'istri' && groupCount > 1) {
                    groupShare = groupShare / groupCount;
                }
                
                const amount = (netEstate * groupShare * heir.count) / (heir.type === 'anak_laki' || heir.type === 'anak_perempuan' ? 
                    (heirGroups['anak_laki']?.reduce((sum, h) => sum + h.count * 2, 0) || 0) + 
                    (heirGroups['anak_perempuan']?.reduce((sum, h) => sum + h.count, 0) || 0) : 1);
                
                totalShares += groupShare * heir.count;
                
                results.push({
                    type: heir.type,
                    icon: heirType.icon,
                    label: heirType.label,
                    count: heir.count,
                    share: groupShare,
                    shareText: shareText,
                    amount: amount
                });
            });
            
            // Normalize shares (Aul)
            if (totalShares > 1) {
                results.forEach(result => {
                    result.amount = (result.amount / totalShares);
                });
            }
            
            return results;
        }

        // Tampilkan hasil
        function displayResults(results, netEstate) {
            const container = document.getElementById('resultsContainer');
            const netDisplay = document.getElementById('netEstateDisplay');
            const totalDisplay = document.getElementById('totalDistributed');
            
            netDisplay.textContent = `Nilai bersih warisan: ${formatRupiah(netEstate)}`;
            
            container.innerHTML = '';
            let totalDistributed = 0;
            
            // Group results by type
            const groupedResults = {};
            results.forEach(result => {
                const key = result.type;
                if (!groupedResults[key]) {
                    groupedResults[key] = {
                        icon: result.icon,
                        label: result.label,
                        count: result.count,
                        shareText: result.shareText,
                        amount: result.amount
                    };
                } else {
                    groupedResults[key].count += result.count;
                    groupedResults[key].amount += result.amount;
                }
            });
            
            // Display grouped results
            Object.values(groupedResults).forEach(result => {
                totalDistributed += result.amount;
                
                const div = document.createElement('div');
                div.className = 'result-item';
                div.innerHTML = `
                    <div class="heir-info">
                        <div class="heir-name">
                            <span>${result.icon}</span>
                            <span>${result.label}</span>
                        </div>
                        <div class="heir-details">
                            ${result.count > 1 ? `${result.count} orang ‚Ä¢ ` : ''}${result.shareText}
                        </div>
                    </div>
                    <div class="heir-amount">
                        ${formatRupiah(result.amount)}
                        <div class="amount-rupiah">(${formatNumber(result.amount)})</div>
                    </div>
                `;
                container.appendChild(div);
            });
            
            totalDisplay.textContent = formatRupiah(totalDistributed);
            
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
        }

        // Tampilkan section
        function showSection(section) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (section === 'input') {
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
                document.getElementById('inputSection').style.display = 'block';
                document.getElementById('resultsSection').style.display = 'none';
            } else {
                document.querySelector('.nav-item:nth-child(2)').classList.add('active');
                document.getElementById('inputSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';
            }
        }

        // Tampilkan aturan
        function showRules() {
            const rules = `
            <strong>Aturan Pembagian Warisan Islam:</strong><br><br>
            
            <strong>Ahli Waris Pokok:</strong><br>
            ‚Ä¢ Suami: ¬Ω (jika tidak ada anak) atau ¬º (jika ada anak)<br>
            ‚Ä¢ Istri: ¬º (jika tidak ada anak) atau ‚Öõ (jika ada anak)<br>
            ‚Ä¢ Anak laki-laki: 2 bagian dari anak perempuan<br>
            ‚Ä¢ Anak perempuan: ¬Ω (jika sendirian) atau ‚Öî (jika berdua atau lebih)<br>
            ‚Ä¢ Ayah: ‚Öô (jika ada anak) atau ‚Öì (jika tidak ada anak)<br>
            ‚Ä¢ Ibu: ‚Öô (jika ada anak/saudara) atau ‚Öì (jika tidak ada)<br><br>
            
            <strong>Ketetapan Tambahan:</strong><br>
            1. Hutang wajib dibayar sebelum pembagian<br>
            2. Wasiat maksimal ‚Öì dari harta bersih<br>
            3. Ahli waris harus beragama Islam<br>
            4. Pembunuh tidak mendapat warisan<br><br>
            
            <em>Catatan: Aplikasi ini sebagai panduan. Konsultasikan dengan ulama untuk kepastian hukum.</em>
            `;
            
            alert(rules);
        }

        // Reset kalkulator
        function resetCalculator() {
            if (confirm('Reset semua data? Data akan dihapus permanen.')) {
                heirs = [];
                nextHeirId = 1;
                document.getElementById('totalEstate').value = '';
                document.getElementById('debtAmount').value = '';
                document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.toggle-btn:first-child').classList.add('active');
                document.getElementById('debtSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'none';
                
                addHeir();
                showSection('input');
                localStorage.removeItem('inheritanceData');
                showToast('Data telah direset');
            }
        }

        // Toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // LocalStorage functions
        function saveToLocalStorage() {
            const data = {
                heirs: heirs,
                totalEstate: document.getElementById('totalEstate').value,
                hasDebt: document.querySelector('.toggle-btn:nth-child(2)').classList.contains('active'),
                debtAmount: document.getElementById('debtAmount').value
            };
            localStorage.setItem('inheritanceData', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('inheritanceData');
            if (saved) {
                const data = JSON.parse(saved);
                heirs = data.heirs || [];
                nextHeirId = heirs.length > 0 ? Math.max(...heirs.map(h => h.id)) + 1 : 1;
                
                if (heirs.length === 0) {
                    addHeir();
                } else {
                    renderHeirs();
                }
                
                document.getElementById('totalEstate').value = data.totalEstate || '';
                document.getElementById('debtAmount').value = data.debtAmount || '';
                
                if (data.hasDebt) {
                    document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelector('.toggle-btn:nth-child(2)').classList.add('active');
                    document.getElementById('debtSection').style.display = 'block';
                }
            }
        }

        // Save calculation history
        function saveToHistory(totalEstate, netEstate, results) {
            const history = {
                date: new Date().toLocaleString('id-ID'),
                totalEstate: totalEstate,
                netEstate: netEstate,
                heirsCount: heirs.length,
                results: results.map(r => ({
                    type: r.type,
                    amount: r.amount
                }))
            };
            
            let historyList = JSON.parse(localStorage.getItem('inheritanceHistory') || '[]');
            historyList.unshift(history);
            
            if (historyList.length > 10) {
                historyList = historyList.slice(0, 10);
            }
            
            localStorage.setItem('inheritanceHistory', JSON.stringify(historyList));
        }
    </script>
</body>
</html>